<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Santa Premium | Tirage au Sort √âl√©gant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-red: #e63946;
            --dark-red: #c1121f;
            --christmas-green: #2a9d8f;
            --dark-green: #264653;
            --gold: #e9c46a;
            --light-gold: #f4e8c1;
            --snow-white: #f8f9fa;
            --coal-black: #212529;
            --soft-gray: #e9ecef;
            --medium-gray: #adb5bd;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --border-radius: 16px;
            --border-radius-sm: 10px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--coal-black);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(233, 196, 106, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(42, 157, 143, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(230, 57, 70, 0.03) 0%, transparent 30%);
            z-index: -1;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        /* Header √©l√©gant avec animation */
        .main-header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 20px;
            position: relative;
        }

        .header-content {
            background: linear-gradient(135deg, var(--snow-white) 0%, #ffffff 100%);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
        }

        .header-content::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-red), var(--christmas-green), var(--gold));
        }

        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .santa-icon {
            font-size: 2.5rem;
            color: var(--primary-red);
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
            animation: float 3s ease-in-out infinite;
        }

        .tree-icon {
            font-size: 2.5rem;
            color: var(--christmas-green);
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
            animation: float 3s ease-in-out infinite 0.5s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            color: var(--coal-black);
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-red), var(--christmas-green));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: var(--medium-gray);
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 20px;
            line-height: 1.7;
        }

        /* Cartes de fonctionnalit√©s */
        .feature-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .feature-card {
            background: var(--snow-white);
            border-radius: var(--border-radius-sm);
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .feature-icon {
            font-size: 2.2rem;
            color: var(--primary-red);
            margin-bottom: 15px;
            display: inline-block;
        }

        .feature-card h3 {
            color: var(--dark-green);
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .feature-card p {
            color: var(--medium-gray);
            font-size: 0.95rem;
        }

        /* Sections principales */
        .main-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .main-sections {
                grid-template-columns: 1fr;
            }
        }

        .section-card {
            background: var(--snow-white);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: var(--transition);
            height: fit-content;
        }

        .section-card:hover {
            box-shadow: var(--shadow-hover);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--soft-gray);
        }

        .section-icon {
            font-size: 1.8rem;
            color: var(--primary-red);
            background: rgba(230, 57, 70, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .section-header h2 {
            color: var(--dark-green);
            font-size: 1.8rem;
            font-weight: 700;
        }

        /* Formulaire d'ajout */
        .input-group {
            display: flex;
            margin-bottom: 25px;
            gap: 10px;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        input[type="text"] {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--soft-gray);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            color: var(--coal-black);
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--christmas-green);
            box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.2);
        }

        .input-wrapper i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--medium-gray);
        }

        .btn {
            padding: 16px 28px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-red), var(--dark-red));
            color: white;
            box-shadow: 0 4px 12px rgba(230, 57, 70, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--dark-red), var(--primary-red));
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(230, 57, 70, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--christmas-green), var(--dark-green));
            color: white;
            box-shadow: 0 4px 12px rgba(42, 157, 143, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, var(--dark-green), var(--christmas-green));
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(42, 157, 143, 0.4);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold), #d4a017);
            color: var(--coal-black);
            box-shadow: 0 4px 12px rgba(233, 196, 106, 0.4);
        }

        .btn-gold:hover {
            background: linear-gradient(135deg, #d4a017, var(--gold));
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(233, 196, 106, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-red);
            border: 2px solid var(--primary-red);
        }

        .btn-outline:hover {
            background: var(--primary-red);
            color: white;
        }

        /* Liste des participants */
        .participants-container {
            margin-top: 20px;
        }

        .participant-count {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: var(--dark-green);
            font-weight: 600;
        }

        .count-badge {
            background: var(--christmas-green);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .participants-list {
            list-style: none;
            max-height: 350px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .participants-list::-webkit-scrollbar {
            width: 8px;
        }

        .participants-list::-webkit-scrollbar-track {
            background: var(--soft-gray);
            border-radius: 10px;
        }

        .participants-list::-webkit-scrollbar-thumb {
            background: var(--primary-red);
            border-radius: 10px;
        }

        .participant-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            margin-bottom: 12px;
            background: white;
            border-radius: var(--border-radius-sm);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-red);
            transition: var(--transition);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .participant-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.08);
        }

        .participant-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .participant-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-red), var(--gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .participant-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark-green);
        }

        .participant-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .edit-btn {
            background: rgba(42, 157, 143, 0.1);
            color: var(--christmas-green);
        }

        .edit-btn:hover {
            background: var(--christmas-green);
            color: white;
        }

        .delete-btn {
            background: rgba(230, 57, 70, 0.1);
            color: var(--primary-red);
        }

        .delete-btn:hover {
            background: var(--primary-red);
            color: white;
        }

        .empty-list {
            text-align: center;
            padding: 40px 20px;
            color: var(--medium-gray);
        }

        .empty-list i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--soft-gray);
        }

        /* Section r√©sultats */
        .results-section {
            display: none;
            margin-top: 40px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .assignments-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .assignment-card {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-top: 4px solid var(--gold);
            position: relative;
            overflow: hidden;
        }

        .assignment-card.revealed {
            border-top-color: var(--christmas-green);
            background: linear-gradient(135deg, #f8fff8 0%, #ffffff 100%);
        }

        .assignment-card.revealed::after {
            content: "üéÅ";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            opacity: 0.7;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .participant-giver {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--dark-green);
        }

        .card-content {
            text-align: center;
            padding: 15px 0;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .card-content.hidden {
            background: var(--soft-gray);
            border-radius: var(--border-radius-sm);
            position: relative;
        }

        .card-content.hidden::before {
            content: "???";
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--medium-gray);
            letter-spacing: 5px;
        }

        .assigned-person {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary-red);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin: 10px 0;
        }

        .card-footer {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }

        /* Animations */
        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(1000px) rotate(360deg); opacity: 0; }
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background: var(--primary-red);
            top: -50px;
            opacity: 0;
            z-index: 1000;
        }

        .confetti:nth-child(odd) { background: var(--christmas-green); }
        .confetti:nth-child(even) { background: var(--gold); }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 18px 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(400px);
            opacity: 0;
            transition: transform 0.4s ease-out, opacity 0.4s;
            border-left: 4px solid var(--christmas-green);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast i {
            font-size: 1.5rem;
            color: var(--christmas-green);
        }

        .toast.error { border-left-color: var(--primary-red); }
        .toast.error i { color: var(--primary-red); }

        .toast.warning { border-left-color: var(--gold); }
        .toast.warning i { color: var(--gold); }

        /* Footer */
        .main-footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            color: var(--medium-gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--soft-gray);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            transform: translateY(-30px);
            transition: transform 0.4s;
            position: relative;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            margin-bottom: 25px;
            text-align: center;
        }

        .modal-header h3 {
            color: var(--dark-green);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .modal-body {
            margin-bottom: 30px;
        }

        .modal-footer {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--medium-gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--primary-red);
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2.2rem; }
            .subtitle { font-size: 1rem; }
            .main-sections { gap: 20px; }
            .section-card { padding: 25px 20px; }
            .input-group { flex-direction: column; }
            .btn { width: 100%; }
            .results-header { flex-direction: column; align-items: flex-start; }
            .results-controls { width: 100%; }
            .assignments-container { grid-template-columns: 1fr; }
        }

        /* Accessibilit√© */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles */
        button:focus, input:focus {
            outline: 3px solid rgba(42, 157, 143, 0.5);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-t√™te principal avec titre √©l√©gant -->
        <header class="main-header" role="banner">
            <div class="header-content">
                <div class="title-container">
                    <i class="fas fa-sleigh santa-icon" aria-hidden="true"></i>
                    <h1>Secret Santa Premium</h1>
                    <i class="fas fa-tree tree-icon" aria-hidden="true"></i>
                </div>
                <p class="subtitle">Organisez un tirage au sort Secret Santa √©l√©gant, √©quitable et confidentiel. Notre algorithme garantit que personne ne se tire soi-m√™me, avec une interface sublime et des animations festives.</p>
                
                <div class="feature-cards">
                    <div class="feature-card">
                        <i class="fas fa-user-friends feature-icon" aria-hidden="true"></i>
                        <h3>Ajout Intelligent</h3>
                        <p>Ajoutez et g√©rez les participants avec √©dition en temps r√©el et validation avanc√©e.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-random feature-icon" aria-hidden="true"></i>
                        <h3>Tirage √âquitable</h3>
                        <p>Algorithme de d√©rangement garanti sans auto-assignation, avec v√©rification en temps r√©el.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-eye-slash feature-icon" aria-hidden="true"></i>
                        <h3>Confidentialit√© Totale</h3>
                        <p>Chaque participant ne voit que son destinataire. Option "R√©v√©ler tout" pour l'organisateur.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-file-export feature-icon" aria-hidden="true"></i>
                        <h3>Export Professionnel</h3>
                        <p>Exportez les r√©sultats en CSV pour archivage et partage avec l'organisateur.</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sections principales -->
        <main class="main-sections">
            <!-- Section Participants -->
            <section class="section-card" aria-labelledby="participants-title">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-users" aria-hidden="true"></i>
                    </div>
                    <h2 id="participants-title">Participants</h2>
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <input type="text" id="nameInput" placeholder="Entrez le nom d'un participant..." aria-label="Nom du participant" maxlength="50">
                        <i class="fas fa-user" aria-hidden="true"></i>
                    </div>
                    <button id="addBtn" class="btn btn-primary" aria-label="Ajouter le participant">
                        <i class="fas fa-plus" aria-hidden="true"></i> Ajouter
                    </button>
                </div>
                
                <div class="participants-container">
                    <div class="participant-count">
                        <span>Participants inscrits</span>
                        <div class="count-badge" id="participantCount">0</div>
                    </div>
                    
                    <ul id="participantsList" class="participants-list" aria-label="Liste des participants">
                        <li class="empty-list">
                            <i class="fas fa-user-plus" aria-hidden="true"></i>
                            <p>Commencez par ajouter des participants √† votre liste</p>
                        </li>
                    </ul>
                </div>
                
                <div class="section-actions" style="display: flex; gap: 15px; margin-top: 25px;">
                    <button id="drawBtn" class="btn btn-secondary" disabled style="flex: 1;">
                        <i class="fas fa-random" aria-hidden="true"></i> Effectuer le tirage
                    </button>
                    <button id="resetBtn" class="btn btn-outline" style="flex: 1;">
                        <i class="fas fa-redo" aria-hidden="true"></i> R√©initialiser
                    </button>
                </div>
            </section>

            <!-- Section Instructions -->
            <section class="section-card" aria-labelledby="instructions-title">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-book-open" aria-hidden="true"></i>
                    </div>
                    <h2 id="instructions-title">Comment √ßa marche ?</h2>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <h3 style="color: var(--dark-green); margin-bottom: 15px; font-size: 1.2rem;">Guide d'utilisation</h3>
                    <ol style="padding-left: 20px; color: var(--medium-gray);">
                        <li style="margin-bottom: 12px;"><strong>Ajoutez les participants</strong> en entrant leurs noms et en cliquant sur "Ajouter".</li>
                        <li style="margin-bottom: 12px;"><strong>V√©rifiez la liste</strong> et modifiez si n√©cessaire avec les boutons d'√©dition.</li>
                        <li style="margin-bottom: 12px;"><strong>Cliquez sur "Effectuer le tirage"</strong> pour g√©n√©rer les paires al√©atoires (minimum 2 personnes).</li>
                        <li style="margin-bottom: 12px;"><strong>R√©v√©lez individuellement</strong> en cliquant sur "Voir mon destinataire" pour chaque participant.</li>
                        <li style="margin-bottom: 12px;"><strong>Exportez les r√©sultats</strong> en CSV pour conserver une trace du tirage.</li>
                    </ol>
                </div>
                
                <div>
                    <h3 style="color: var(--dark-green); margin-bottom: 15px; font-size: 1.2rem;">√Ä propos de l'algorithme</h3>
                    <p style="color: var(--medium-gray);">
                        Notre algorithme utilise un <strong>d√©rangement al√©atoire</strong> (permutation sans points fixes) garantissant que personne ne se tire soi-m√™me. Il est bas√© sur l'algorithme de Sattolo am√©lior√© avec v√©rification multiple, et dispose d'une m√©thode de secours d√©terministe pour garantir un r√©sultat en toutes circonstances.
                    </p>
                </div>
            </section>
        </main>

        <!-- Section R√©sultats (cach√©e initialement) -->
        <section id="resultsSection" class="results-section" aria-labelledby="results-title">
            <div class="section-card">
                <div class="results-header">
                    <div class="section-header" style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">
                        <div class="section-icon">
                            <i class="fas fa-gifts" aria-hidden="true"></i>
                        </div>
                        <h2 id="results-title">R√©sultats du tirage</h2>
                    </div>
                    
                    <div class="results-controls">
                        <button id="revealAllBtn" class="btn btn-gold">
                            <i class="fas fa-eye" aria-hidden="true"></i> R√©v√©ler tout
                        </button>
                        <button id="exportBtn" class="btn btn-secondary">
                            <i class="fas fa-file-csv" aria-hidden="true"></i> Exporter CSV
                        </button>
                        <button id="newDrawBtn" class="btn btn-outline">
                            <i class="fas fa-sync" aria-hidden="true"></i> Nouveau tirage
                        </button>
                    </div>
                </div>
                
                <div id="assignmentsContainer" class="assignments-container">
                    <!-- Les cartes d'assignation seront g√©n√©r√©es ici -->
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="main-footer" role="contentinfo">
            <p>üéÑ Secret Santa Premium - Tirage au sort √©l√©gant et √©quitable üéÖ</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">Fonctionne enti√®rement dans votre navigateur ‚Ä¢ Aucune donn√©e n'est envoy√©e √† un serveur ‚Ä¢ Design et code optimis√©s pour une exp√©rience premium</p>
        </footer>
    </div>

    <!-- Modal pour l'export -->
    <div id="exportModal" class="modal-overlay" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal">
            <button class="close-modal" aria-label="Fermer la fen√™tre">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
            
            <div class="modal-header">
                <h3 id="modal-title">Export r√©ussi !</h3>
                <p style="color: var(--medium-gray); margin-top: 10px;">Les r√©sultats ont √©t√© export√©s avec succ√®s.</p>
            </div>
            
            <div class="modal-body">
                <p style="text-align: center; margin-bottom: 20px;">
                    <i class="fas fa-file-csv" style="font-size: 4rem; color: var(--christmas-green);" aria-hidden="true"></i>
                </p>
                <p style="color: var(--medium-gray); text-align: center;">Le fichier <strong>secret_santa_results.csv</strong> a √©t√© g√©n√©r√© et est pr√™t √† √™tre t√©l√©charg√©. V√©rifiez vos t√©l√©chargements.</p>
            </div>
            
            <div class="modal-footer">
                <button id="closeModalBtn" class="btn btn-primary">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Container pour les toasts -->
    <div class="toast-container"></div>

    <script>
        // ============================================
        // √âTAT GLOBAL DE L'APPLICATION
        // ============================================
        const AppState = {
            participants: [],
            assignments: new Map(),
            isDrawDone: false,
            revealedAll: false,
            editIndex: null
        };

        // ============================================
        // R√âF√âRENCES AUX √âL√âMENTS DOM
        // ============================================
        const DOM = {
            nameInput: document.getElementById('nameInput'),
            addBtn: document.getElementById('addBtn'),
            participantsList: document.getElementById('participantsList'),
            participantCount: document.getElementById('participantCount'),
            drawBtn: document.getElementById('drawBtn'),
            resetBtn: document.getElementById('resetBtn'),
            resultsSection: document.getElementById('resultsSection'),
            assignmentsContainer: document.getElementById('assignmentsContainer'),
            revealAllBtn: document.getElementById('revealAllBtn'),
            exportBtn: document.getElementById('exportBtn'),
            newDrawBtn: document.getElementById('newDrawBtn'),
            exportModal: document.getElementById('exportModal'),
            closeModalBtn: document.getElementById('closeModalBtn'),
            closeModalBtn2: document.querySelector('.close-modal')
        };

        // ============================================
        // INITIALISATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            setupEventListeners();
            loadFromLocalStorage();
        });

        function initApp() {
            // Mettre √† jour le compteur initial
            updateParticipantCount();
            
            // Configurer les raccourcis clavier
            DOM.nameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addParticipant();
            });
            
            // Initialiser le modal
            DOM.closeModalBtn.addEventListener('click', () => hideModal());
            DOM.closeModalBtn2.addEventListener('click', () => hideModal());
            DOM.exportModal.addEventListener('click', (e) => {
                if (e.target === DOM.exportModal) hideModal();
            });
        }

        function setupEventListeners() {
            DOM.addBtn.addEventListener('click', addParticipant);
            DOM.drawBtn.addEventListener('click', performDraw);
            DOM.resetBtn.addEventListener('click', resetParticipants);
            DOM.revealAllBtn.addEventListener('click', revealAllAssignments);
            DOM.exportBtn.addEventListener('click', exportToCSV);
            DOM.newDrawBtn.addEventListener('click', newDraw);
        }

        // ============================================
        // FONCTIONS DE GESTION DES PARTICIPANTS
        // ============================================
        function addParticipant() {
            const name = DOM.nameInput.value.trim();
            
            // Validation
            if (!name) {
                showToast('Veuillez entrer un nom valide', 'error');
                DOM.nameInput.focus();
                return;
            }
            
            if (name.length < 2) {
                showToast('Le nom doit contenir au moins 2 caract√®res', 'error');
                return;
            }
            
            if (AppState.participants.includes(name)) {
                showToast('Ce participant existe d√©j√† dans la liste', 'warning');
                DOM.nameInput.select();
                return;
            }
            
            // Ajouter le participant
            AppState.participants.push(name);
            updateParticipantsList();
            updateParticipantCount();
            updateDrawButtonState();
            saveToLocalStorage();
            
            // R√©initialiser le champ
            DOM.nameInput.value = '';
            DOM.nameInput.focus();
            
            // Afficher une confirmation
            showToast(`${name} a √©t√© ajout√© avec succ√®s`, 'success');
            
            // Si un tirage √©tait en cours, le r√©initialiser
            if (AppState.isDrawDone) {
                resetDraw();
            }
        }

        function updateParticipantsList() {
            const participantsList = DOM.participantsList;
            
            // Vider la liste
            participantsList.innerHTML = '';
            
            // Si pas de participants, afficher message
            if (AppState.participants.length === 0) {
                const emptyItem = document.createElement('li');
                emptyItem.className = 'empty-list';
                emptyItem.innerHTML = `
                    <i class="fas fa-user-plus" aria-hidden="true"></i>
                    <p>Commencez par ajouter des participants √† votre liste</p>
                `;
                participantsList.appendChild(emptyItem);
                return;
            }
            
            // Ajouter chaque participant
            AppState.participants.forEach((name, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'participant-item';
                listItem.innerHTML = `
                    <div class="participant-info">
                        <div class="participant-avatar">
                            ${name.charAt(0).toUpperCase()}
                        </div>
                        <span class="participant-name">${name}</span>
                    </div>
                    <div class="participant-actions">
                        <button class="action-btn edit-btn" onclick="editParticipant(${index})" aria-label="√âditer ${name}">
                            <i class="fas fa-edit" aria-hidden="true"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteParticipant(${index})" aria-label="Supprimer ${name}">
                            <i class="fas fa-trash" aria-hidden="true"></i>
                        </button>
                    </div>
                `;
                participantsList.appendChild(listItem);
            });
        }

        function editParticipant(index) {
            const currentName = AppState.participants[index];
            const newName = prompt('Modifier le nom du participant:', currentName);
            
            if (newName && newName.trim() !== '') {
                const trimmedName = newName.trim();
                
                // V√©rifier que le nom n'existe pas d√©j√† (sauf pour le m√™me participant)
                if (AppState.participants.includes(trimmedName) && AppState.participants[index] !== trimmedName) {
                    showToast('Ce nom est d√©j√† utilis√© par un autre participant', 'error');
                    return;
                }
                
                if (trimmedName.length < 2) {
                    showToast('Le nom doit contenir au moins 2 caract√®res', 'error');
                    return;
                }
                
                // Mettre √† jour le nom
                AppState.participants[index] = trimmedName;
                updateParticipantsList();
                saveToLocalStorage();
                showToast('Nom modifi√© avec succ√®s', 'success');
                
                // Si un tirage √©tait en cours, le r√©initialiser
                if (AppState.isDrawDone) {
                    resetDraw();
                }
            }
        }

        function deleteParticipant(index) {
            const name = AppState.participants[index];
            
            if (confirm(`Voulez-vous vraiment supprimer "${name}" de la liste ?`)) {
                AppState.participants.splice(index, 1);
                updateParticipantsList();
                updateParticipantCount();
                updateDrawButtonState();
                saveToLocalStorage();
                showToast(`${name} a √©t√© supprim√© de la liste`, 'success');
                
                // Si un tirage √©tait en cours, le r√©initialiser
                if (AppState.isDrawDone) {
                    resetDraw();
                }
            }
        }

        function updateParticipantCount() {
            DOM.participantCount.textContent = AppState.participants.length;
        }

        function updateDrawButtonState() {
            const hasEnoughParticipants = AppState.participants.length >= 2;
            DOM.drawBtn.disabled = !hasEnoughParticipants;
            
            if (hasEnoughParticipants) {
                DOM.drawBtn.innerHTML = `<i class="fas fa-random" aria-hidden="true"></i> Effectuer le tirage (${AppState.participants.length} participants)`;
            } else {
                DOM.drawBtn.innerHTML = `<i class="fas fa-random" aria-hidden="true"></i> Ajoutez au moins 2 participants`;
            }
        }

        function resetParticipants() {
            if (AppState.participants.length === 0) {
                showToast('La liste est d√©j√† vide', 'info');
                return;
            }
            
            if (confirm(`Voulez-vous vraiment supprimer tous les participants (${AppState.participants.length}) ?`)) {
                AppState.participants = [];
                updateParticipantsList();
                updateParticipantCount();
                updateDrawButtonState();
                saveToLocalStorage();
                resetDraw();
                showToast('Tous les participants ont √©t√© supprim√©s', 'success');
            }
        }

        // ============================================
        // FONCTIONS DE TIRAGE AU SORT
        // ============================================
        function performDraw() {
            if (AppState.participants.length < 2) {
                showToast('Au moins 2 participants sont n√©cessaires pour effectuer le tirage', 'error');
                return;
            }
            
            // G√©n√©rer un d√©rangement (permutation sans points fixes)
            const assignments = generateDerangement(AppState.participants);
            
            if (!assignments) {
                showToast('Erreur lors du tirage. Veuillez r√©essayer.', 'error');
                return;
            }
            
            // Stocker les r√©sultats
            AppState.assignments = assignments;
            AppState.isDrawDone = true;
            AppState.revealedAll = false;
            
            // Afficher les r√©sultats
            displayAssignments();
            DOM.resultsSection.style.display = 'block';
            
            // Mettre √† jour le bouton "R√©v√©ler tout"
            DOM.revealAllBtn.disabled = false;
            DOM.revealAllBtn.innerHTML = `<i class="fas fa-eye" aria-hidden="true"></i> R√©v√©ler tout`;
            
            // Afficher une animation de confetti
            createConfetti();
            
            // Afficher un message de succ√®s
            showToast('Tirage au sort effectu√© avec succ√®s !', 'success');
            
            // Faire d√©filer jusqu'aux r√©sultats
            DOM.resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        /**
         * ALGORITHME DE D√âRANGEMENT AM√âLIOR√â
         * G√©n√®re une permutation al√©atoire sans points fixes
         */
        function generateDerangement(participants) {
            const n = participants.length;
            
            // Cas sp√©ciaux
            if (n === 0) return new Map();
            if (n === 1) return new Map([[participants[0], participants[0]]]);
            
            // Copie de la liste
            let receivers = [...participants];
            let attempts = 0;
            const maxAttempts = 1000;
            
            // Essayer de g√©n√©rer un d√©rangement valide
            while (attempts < maxAttempts) {
                attempts++;
                
                // M√©langer al√©atoirement
                for (let i = n - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [receivers[i], receivers[j]] = [receivers[j], receivers[i]];
                }
                
                // V√©rifier qu'il n'y a pas d'auto-assignation
                let isValid = true;
                for (let i = 0; i < n; i++) {
                    if (participants[i] === receivers[i]) {
                        isValid = false;
                        break;
                    }
                }
                
                // Si valide, cr√©er la Map des assignations
                if (isValid) {
                    const assignments = new Map();
                    for (let i = 0; i < n; i++) {
                        assignments.set(participants[i], receivers[i]);
                    }
                    return assignments;
                }
            }
            
            // Si on n'a pas trouv√© de solution al√©atoire, utiliser l'algorithme d√©terministe
            return generateDeterministicDerangement(participants);
        }

        /**
         * ALGORITHME D√âTERMINISTE DE D√âRANGEMENT
         * Garantit un r√©sultat m√™me dans les cas difficiles
         */
        function generateDeterministicDerangement(participants) {
            const n = participants.length;
            const receivers = [...participants];
            
            // Pour un nombre pair de participants
            if (n % 2 === 0) {
                // D√©calage circulaire de 1
                const first = receivers.shift();
                receivers.push(first);
            } else {
                // Pour un nombre impair, √©changer par paires
                for (let i = 0; i < n - 1; i += 2) {
                    [receivers[i], receivers[i + 1]] = [receivers[i + 1], receivers[i]];
                }
            }
            
            // Cr√©er la Map des assignations
            const assignments = new Map();
            for (let i = 0; i < n; i++) {
                assignments.set(participants[i], receivers[i]);
            }
            
            return assignments;
        }

        function displayAssignments() {
            const container = DOM.assignmentsContainer;
            container.innerHTML = '';
            
            AppState.participants.forEach(participant => {
                const assignedTo = AppState.assignments.get(participant);
                
                const card = document.createElement('div');
                card.className = 'assignment-card';
                card.setAttribute('data-participant', participant);
                card.innerHTML = `
                    <div class="card-header">
                        <div class="participant-giver">${participant}</div>
                        <div class="reveal-status" style="font-size: 0.9rem; color: var(--medium-gray);">
                            <i class="fas fa-lock" aria-hidden="true"></i> Cach√©
                        </div>
                    </div>
                    <div class="card-content hidden">
                        <!-- Le contenu cach√© sera r√©v√©l√© au clic -->
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-primary reveal-btn" onclick="revealAssignment('${participant}')">
                            <i class="fas fa-eye" aria-hidden="true"></i> Voir mon destinataire
                        </button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function revealAssignment(participant) {
            const card = document.querySelector(`.assignment-card[data-participant="${participant}"]`);
            if (!card) return;
            
            const assignedTo = AppState.assignments.get(participant);
            const cardContent = card.querySelector('.card-content');
            const revealStatus = card.querySelector('.reveal-status');
            const revealBtn = card.querySelector('.reveal-btn');
            
            // Remplacer le contenu cach√© par le destinataire
            cardContent.className = 'card-content';
            cardContent.innerHTML = `
                <div style="margin-bottom: 10px; color: var(--medium-gray);">
                    <i class="fas fa-gift" aria-hidden="true"></i> Vous offrez un cadeau √† :
                </div>
                <div class="assigned-person">${assignedTo}</div>
                <div style="margin-top: 15px; font-size: 0.9rem; color: var(--christmas-green);">
                    <i class="fas fa-check-circle" aria-hidden="true"></i> Destinataire r√©v√©l√©
                </div>
            `;
            
            // Mettre √† jour le statut
            revealStatus.innerHTML = `<i class="fas fa-unlock" aria-hidden="true"></i> R√©v√©l√©`;
            revealStatus.style.color = 'var(--christmas-green)';
            
            // D√©sactiver le bouton
            revealBtn.disabled = true;
            revealBtn.innerHTML = `<i class="fas fa-check" aria-hidden="true"></i> R√©v√©l√©`;
            revealBtn.className = 'btn btn-secondary';
            
            // Ajouter la classe "revealed" pour le style
            card.classList.add('revealed');
            
            // Mettre √† jour le compteur de cartes r√©v√©l√©es
            updateRevealAllButton();
        }

        function revealAllAssignments() {
            if (!AppState.isDrawDone) {
                showToast('Aucun tirage n\'a √©t√© effectu√©', 'error');
                return;
            }
            
            if (AppState.revealedAll) {
                showToast('Tous les destinataires sont d√©j√† r√©v√©l√©s', 'info');
                return;
            }
            
            if (!confirm('√ätes-vous s√ªr de vouloir r√©v√©ler tous les destinataires ? Cette action est destin√©e √† l\'organisateur et ne peut √™tre annul√©e.')) {
                return;
            }
            
            // R√©v√©ler toutes les cartes
            AppState.participants.forEach(participant => {
                const card = document.querySelector(`.assignment-card[data-participant="${participant}"]`);
                if (card && !card.classList.contains('revealed')) {
                    revealAssignment(participant);
                }
            });
            
            AppState.revealedAll = true;
            DOM.revealAllBtn.disabled = true;
            DOM.revealAllBtn.innerHTML = `<i class="fas fa-check" aria-hidden="true"></i> Tout r√©v√©l√©`;
            
            showToast('Tous les destinataires ont √©t√© r√©v√©l√©s', 'success');
        }

        function updateRevealAllButton() {
            if (!AppState.isDrawDone) return;
            
            const revealedCards = document.querySelectorAll('.assignment-card.revealed').length;
            const totalCards = AppState.participants.length;
            
            if (revealedCards === totalCards) {
                DOM.revealAllBtn.disabled = true;
                DOM.revealAllBtn.innerHTML = `<i class="fas fa-check" aria-hidden="true"></i> Tout r√©v√©l√©`;
                AppState.revealedAll = true;
            } else {
                DOM.revealAllBtn.disabled = false;
                DOM.revealAllBtn.innerHTML = `<i class="fas fa-eye" aria-hidden="true"></i> R√©v√©ler tout (${totalCards - revealedCards} restants)`;
            }
        }

        function newDraw() {
            if (!AppState.isDrawDone) {
                showToast('Aucun tirage n\'a √©t√© effectu√©', 'error');
                return;
            }
            
            if (confirm('Effectuer un nouveau tirage ? Les r√©sultats actuels seront perdus.')) {
                resetDraw();
                performDraw();
            }
        }

        function resetDraw() {
            AppState.assignments = new Map();
            AppState.isDrawDone = false;
            AppState.revealedAll = false;
            DOM.resultsSection.style.display = 'none';
        }

        // ============================================
        // FONCTIONS D'EXPORT
        // ============================================
        function exportToCSV() {
            if (!AppState.isDrawDone) {
                showToast('Aucun tirage n\'a √©t√© effectu√©', 'error');
                return;
            }
            
            // Cr√©er le contenu CSV
            let csvContent = "data:text/csv;charset=utf-8,Participant,Destinataire\n";
            
            AppState.assignments.forEach((value, key) => {
                csvContent += `"${key}","${value}"\n`;
            });
            
            // Cr√©er un lien de t√©l√©chargement
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `secret_santa_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            
            // D√©clencher le t√©l√©chargement
            link.click();
            document.body.removeChild(link);
            
            // Afficher le modal de confirmation
            showModal();
        }

        // ============================================
        // FONCTIONS D'ANIMATION ET D'INTERFACE
        // ============================================
        function createConfetti() {
            const confettiCount = 100;
            const colors = ['var(--primary-red)', 'var(--christmas-green)', 'var(--gold)'];
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = `${Math.random() * 15 + 5}px`;
                confetti.style.height = `${Math.random() * 15 + 5}px`;
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                
                document.body.appendChild(confetti);
                
                // Animation
                const animationDuration = Math.random() * 3 + 2;
                confetti.style.animation = `confettiFall ${animationDuration}s linear forwards`;
                confetti.style.opacity = '1';
                
                // Supprimer apr√®s l'animation
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, animationDuration * 1000);
            }
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            toast.innerHTML = `
                <i class="fas fa-${icon}" aria-hidden="true"></i>
                <div>${message}</div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Afficher avec animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Masquer apr√®s 4 secondes
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 400);
            }, 4000);
        }

        function showModal() {
            DOM.exportModal.classList.add('active');
        }

        function hideModal() {
            DOM.exportModal.classList.remove('active');
        }

        // ============================================
        // STOCKAGE LOCAL
        // ============================================
        function saveToLocalStorage() {
            const data = {
                participants: AppState.participants,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('secretSantaData', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('secretSantaData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    AppState.participants = data.participants || [];
                    updateParticipantsList();
                    updateParticipantCount();
                    updateDrawButtonState();
                    
                    if (AppState.participants.length > 0) {
                        showToast(`${AppState.participants.length} participants charg√©s depuis la sauvegarde`, 'info');
                    }
                } catch (e) {
                    console.error('Erreur lors du chargement des donn√©es:', e);
                }
            }
        }

        // ============================================
        // EXPORT DES FONCTIONS GLOBALES
        // ============================================
        window.editParticipant = editParticipant;
        window.deleteParticipant = deleteParticipant;
        window.revealAssignment = revealAssignment;
    </script>
</body>
</html>